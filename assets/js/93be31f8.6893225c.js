"use strict";(self.webpackChunkqtaskmachine_doc=self.webpackChunkqtaskmachine_doc||[]).push([[114],{1660:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>S,frontMatter:()=>s,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"guides/functions/group","title":"\u72b6\u6001\u5206\u7ec4","description":"\u7236\u72b6\u6001","source":"@site/docs/guides/functions/group.md","sourceDirName":"guides/functions","slug":"/guides/functions/group","permalink":"/qtaskmachine/docs/guides/functions/group","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"guides","previous":{"title":"\u529f\u80fd","permalink":"/qtaskmachine/docs/category/\u529f\u80fd"},"next":{"title":"\u591a\u6761\u4ef6\u72b6\u6001\u5207\u6362","permalink":"/qtaskmachine/docs/guides/functions/condition"}}');var i=n(4848),r=n(8453);const s={sidebar_position:1},c="\u72b6\u6001\u5206\u7ec4",o={},u=[{value:"\u7236\u72b6\u6001",id:"\u7236\u72b6\u6001",level:2},{value:"\u72b6\u6001\u8f6c\u79fb\u7ee7\u627f",id:"\u72b6\u6001\u8f6c\u79fb\u7ee7\u627f",level:2}];function g(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"\u72b6\u6001\u5206\u7ec4",children:"\u72b6\u6001\u5206\u7ec4"})}),"\n",(0,i.jsx)(t.h2,{id:"\u7236\u72b6\u6001",children:"\u7236\u72b6\u6001"}),"\n",(0,i.jsxs)(t.p,{children:["\u8bbe\u7f6e\u7236\u72b6\u6001\u4e3a\u540c\u4e00\u4e2a\u72b6\u6001\u5c06\u4e00\u7cfb\u5217\u72b6\u6001\u8fdb\u884c\u5206\u7ec4\uff0c\u7236\u72b6\u6001\u9700\u8981\u7b49\u5f85\u5b50\u72b6\u6001\u7ed3\u675f\uff08\u5207\u6362\u5230",(0,i.jsx)(t.code,{children:"QFinalState"}),"\uff09\uff0c\u518d\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u72b6\u6001\uff1a"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:'auto machine = new QStateMachine;\n\n//\u72b6\u6001\u5b9a\u4e49\nauto beginState = new DirectState(machine);\nbeginState->bindState(TaskStateType::State_Enter, machine, [&] {\n    qDebug() << "begin state run...";\n});\n\nauto groupState = new GroupState(machine);\ngroupState->bindState(TaskStateType::State_Enter, machine, [&] {\n    qDebug() << "group state entered...";\n});\ngroupState->bindState(TaskStateType::State_Exit, machine, [&] {\n    qDebug() << "group state exited...";\n});\n\n{\n    auto s1 = new DirectState(groupState);\n    s1->bindState(TaskStateType::State_Enter, machine, [&] {\n        qDebug() << "group s1 enter...";\n    });\n\n    auto s2 = new DirectState(groupState);\n    s2->bindState(TaskStateType::State_Enter, machine, [&] {\n        qDebug() << "group s2 enter...";\n    });\n\n    auto finalState = new QFinalState(groupState);\n    connect(finalState, &QState::entered, machine, [&] {\n        qDebug() << "group final enter...";\n    });\n\n    //\u72b6\u6001\u5207\u6362\n    *s1 >> s2 >> finalState;\n\n    groupState->setInitialState(s1);\n}\n\nauto finalState = new QFinalState(machine);\nconnect(finalState, &QState::entered, machine, [&] {\n    qDebug() << "final...";\n});\n\n//\u72b6\u6001\u5207\u6362\n*beginState >> groupState >> finalState;\n\n//\u521d\u59cb\u5316\u5e76\u5f00\u59cb\nmachine->setInitialState(beginState);\nmachine->start();\n'})}),"\n",(0,i.jsx)(t.p,{children:"\u6267\u884c\u4e0a\u9762\u7684\u4ee3\u7801\u4f9d\u6b21\u6253\u5370\uff1a"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-log",children:"[18:51:46.079] -> begin state run...\n[18:51:46.079] -> group state entered...\n[18:51:46.080] -> group s1 enter...\n[18:51:46.080] -> group s2 enter...\n[18:51:46.080] -> group final enter...\n[18:51:46.081] -> group state exited...\n[18:51:46.081] -> final...\n"})}),"\n",(0,i.jsx)(t.h2,{id:"\u72b6\u6001\u8f6c\u79fb\u7ee7\u627f",children:"\u72b6\u6001\u8f6c\u79fb\u7ee7\u627f"}),"\n",(0,i.jsxs)(t.p,{children:["\u5b50\u72b6\u6001\u9690\u5f0f\u7ee7\u627f\u6240\u6709\u7236\u72b6\u6001\u7684\u72b6\u6001\u5207\u6362\uff0c\u56e0\u6b64\uff0c\u5f53\u4f7f\u7528",(0,i.jsx)(t.code,{children:"EventState"}),"\u4f5c\u4e3a\u7236\u72b6\u6001\u65f6\uff0c\u6240\u6709\u5b50\u72b6\u6001\u4e5f\u4f1a\u54cd\u5e94\u6b63\u5e38\u548c\u5f02\u5e38\u4fe1\u53f7\u5e76\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u5206\u652f\u6216\u5f02\u5e38\u5206\u652f\uff1a"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:'class GroupEventTrigger : public QObject {\n    Q_OBJECT\n\npublic:\n    using QObject::QObject;\n\nsignals:\n    void finish();\n    void fail();\n};\n\nclass GroupStateRun : public QObject {\npublic:\n    static QStateMachine* run(GroupEventTrigger* trigger) {\n        auto machine = new QStateMachine;\n\n        //\u72b6\u6001\u5b9a\u4e49\n        auto beginState = new DirectState(machine);\n        beginState->bindState(TaskStateType::State_Enter, machine, [&] {\n            qDebug() << "begin state run...";\n        });\n\n        auto failState = new DirectState(machine);\n        failState->bindState(TaskStateType::State_Enter, machine, [&] {\n            qDebug() << "fail state run...";\n        });\n\n        auto groupState = new EventState(machine);\n        //\u89e6\u53d1finish\u76f4\u63a5\u7ed3\u675f\u5b50\u72b6\u6001\uff0c\u5e76\u5207\u6362\u5230\u7ec4\u72b6\u6001\u4e0b\u4e00\u4e2a\u72b6\u6001\n        groupState->setSignal(trigger, &GroupEventTrigger::finish);\n        //\u4e3b\u52a8\u89e6\u53d1\u5931\u8d25\uff0c\u4ece\u5b50\u72b6\u6001\u76f4\u63a5\u5207\u6362\u5230\u5931\u8d25\u72b6\u6001\n        connect(trigger, &GroupEventTrigger::fail, groupState, &EventState::triggerSignalFail);\n        groupState->bindState(TaskStateType::State_Enter, machine, [&] {\n            qDebug() << "group state entered...";\n        });\n        groupState->bindState(TaskStateType::State_Exit, machine, [&] {\n            qDebug() << "group state exited...";\n        });\n\n        {\n            auto s1 = new DirectState(groupState);\n            s1->bindState(TaskStateType::State_Enter, machine, [&] {\n                qDebug() << "group s1 enter...";\n            });\n\n            auto s2 = new DelayState(5000, groupState);\n            s2->bindState(TaskStateType::State_Enter, machine, [&] {\n                qDebug() << "group s2 enter...";\n            });\n            s2->bindState(TaskStateType::State_Exit, machine, [&] {\n                qDebug() << "group s2 exited...";\n            });\n\n            auto finalState = new QFinalState(groupState);\n            connect(finalState, &QState::entered, machine, [&] {\n                qDebug() << "group final enter...";\n            });\n\n            //\u72b6\u6001\u5207\u6362\n            *s1 >> s2 >> finalState;\n\n            groupState->setInitialState(s1);\n        }\n\n        auto nextState = new DirectState(machine);\n        nextState->bindState(TaskStateType::State_Enter, machine, [&] {\n            qDebug() << "next state enter...";\n        });\n\n        auto finalState = new QFinalState(machine);\n        connect(finalState, &QState::entered, machine, [&] {\n            qDebug() << "final...";\n        });\n\n        //\u72b6\u6001\u5207\u6362\n        groupState->setFailState(failState);\n        *beginState >> groupState >> nextState >> finalState;\n        *failState >> finalState;\n\n        //\u521d\u59cb\u5316\u5e76\u5f00\u59cb\n        machine->setInitialState(beginState);\n        machine->start();\n\n        return machine;\n    }\n};\n'})}),"\n",(0,i.jsxs)(t.p,{children:["\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u5f53\u524d\u72b6\u6001\u5728",(0,i.jsx)(t.code,{children:"s2"}),"\u5ef6\u65f6\u72b6\u6001\uff0c\u4e0d\u505a\u4efb\u4f55\u4e8b\u5c06\u7b49\u5f855s\u5207\u6362\u5230",(0,i.jsx)(t.code,{children:"nextState"}),"\uff1a"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-log",children:"[18:58:15.302] -> begin state run...\n[18:58:15.303] -> group state entered...\n[18:58:15.303] -> group s1 enter...\n[18:58:15.303] -> group s2 enter...\n[18:58:20.291] -> group s2 exited...\n[18:58:20.292] -> group final enter...\n[18:58:20.293] -> group state exited...\n[18:58:20.293] -> next state enter...\n[18:58:20.294] -> final...\n"})}),"\n",(0,i.jsxs)(t.p,{children:["\u800c\u5982\u679c\u4e3b\u52a8\u89e6\u53d1\u6b63\u5e38\u6216\u5f02\u5e38\u5206\u652f\uff0c",(0,i.jsx)(t.code,{children:"s2"}),"\u5c06\u7acb\u5373\u9000\u51fa\uff1a"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-log",children:"[19:00:55.495] -> begin state run...\n[19:00:55.495] -> group state entered...\n[19:00:55.496] -> group s1 enter...\n[19:00:55.496] -> group s2 enter...\n[19:00:56.645] -> group s2 exited...\n[19:00:56.646] -> group state exited...\n[19:00:56.646] -> next state enter...\n[19:00:56.646] -> final...\n"})})]})}function S(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>c});var a=n(6540);const i={},r=a.createContext(i);function s(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);